<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Knowledge | KnowHub</title>

    <!-- Base / Template styles -->
    <link rel="stylesheet" href="./assets/css/template.css" />
    <!-- Page styles (compile knowledge.scss -> assets/css/knowledge.css) -->
    <link rel="stylesheet" href="./assets/css/knowledge.css" />

    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
      onload="renderMathInElement(document.body,{
        delimiters:[
          {left:'$$',right:'$$',display:true},
          {left:'$',right:'$',display:false},
          {left:'\\(',right:'\\)',display:false},
          {left:'\\[',right:'\\]',display:true}
        ],
        throwOnError:false
      });"
    ></script>
  </head>
  <body class="kh-body">

    <!-- Header（置中 LOGO）-->
    <header class="kh-header">
      <div class="kh-header__inner">
        <a class="kh-logo" href="./index.html" aria-label="回到首頁">
          <img src="./images/Know-hub.png" alt="KnowHub Logo" />
        </a>
      </div>
    </header>

    <!-- Layout：左側側欄 + 右側內容 -->
    <div class="kh-shell">
      <!-- SideNav -->
      <aside class="kh-sidenav" data-open="true">
        <button id="sidenav-toggle" class="kh-sidenav__toggle" aria-expanded="true">☰ 類別</button>

        <!-- 側欄搜尋（只篩側欄清單；不打 API） -->
        <label class="kh-side-search" for="side-search">
          <span class="icon" aria-hidden="true">🔎</span>
          <input id="side-search" type="search" placeholder="搜尋標題…" autocomplete="off" />
        </label>

        <!-- 科目勾選（只影響『隨機』來源；預設全開） -->
        <section class="kh-random-filter" aria-label="隨機科目來源">
          <h3>隨機來源科目</h3>
          <div id="random-subjects" class="kh-subject-checks"></div>
          <p class="hint">✓ 勾選的科目會用於「🎲 隨機」；手動從清單點標題不受影響。</p>
        </section>

        <!-- 樹狀清單（科目 → 標題） -->
        <nav id="nav-tree" class="kh-tree" aria-label="知識清單"></nav>
      </aside>

      <!-- Content -->
      <main class="kh-content" id="kh-content" aria-live="polite">
        <div class="kh-toolbar">
          <button id="btn-random" class="btn btn-primary" type="button">🎲 隨機</button>
          <span class="kh-toolbar__spacer"></span>
          <button id="btn-refresh" class="btn" type="button" title="重新整理索引">↻ 重整索引</button>
        </div>

        <!-- 內容卡片區（JS 會把每個大段落切成 .section-card 注入這裡） -->
        <div id="knowledge-card" class="kh-card-host"></div>

        <!-- 頁面底部：回首頁 -->
        <div class="kh-bottom-home">
          <a class="kh-home-btn" href="./index.html" aria-label="回到首頁">🏠 回首頁</a>
        </div>
      </main>
    </div>

    <footer class="kh-footer">
      <div class="kh-footer__inner">
        <small>© <span id="year"></span> KnowHub — Keep learning, keep earning 💸</small>
      </div>
    </footer>

    <!-- Config: 設定你的 Worker 網址與科目清單 -->
    <script>
      window.KNOWHUB = window.KNOWHUB || {};
      // TODO: 換成你實際的 Cloudflare Workers 網址
      window.KNOWHUB.API_BASE = window.KNOWHUB.API_BASE || "https://knowhub-knowledge.ytllama1225.workers.dev";
      window.KNOWHUB.SUBJECTS = window.KNOWHUB.SUBJECTS || ["國文","英文","數學","物理","化學","生物","地球科學"];
      document.addEventListener('DOMContentLoaded', () => {
        const y = document.getElementById('year');
        if (y) y.textContent = new Date().getFullYear();
      });
    </script>

    <!-- Main logic -->
    <script src="./assets/js/knowledge.js" defer></script>
  </body>
</html>
